"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
const chalk_1 = __importDefault(require("chalk"));
const getenv_1 = require("getenv");
const isProfiling = getenv_1.boolish('EXPO_PROFILE', false);
// eslint-disable-next-line no-console
const consoleTime = isProfiling ? console.time : () => { };
// eslint-disable-next-line no-console
const consoleTimeEnd = isProfiling ? console.timeEnd : () => { };
/**
 * Wrap a method and profile the time it takes to execute the method using `EXPO_PROFILE`.
 * Works best with named functions (i.e. not arrow functions).
 *
 * @param fn
 * @param functionName
 */
exports.profileMethod = (fn, functionName) => {
    const name = chalk_1.default.dim(`â±  [profile] ${functionName !== null && functionName !== void 0 ? functionName : (fn.name || 'unknown')}`);
    return (...args) => {
        consoleTime(name);
        const results = fn(...args);
        if (results instanceof Promise) {
            // @ts-ignore
            return new Promise((resolve, reject) => {
                results
                    .then(results => {
                    resolve(results);
                    consoleTimeEnd(name);
                })
                    .catch(error => {
                    reject(error);
                    consoleTimeEnd(name);
                });
            });
        }
        else {
            consoleTimeEnd(name);
        }
        return results;
    };
};
//# sourceMappingURL=profileMethod.js.map